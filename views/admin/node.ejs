<%- include('../components/template') %>

<main id="content">

<div style="width:100%; min-height:100vh; overflow-x:hidden; padding:12px 16px; box-sizing:border-box;">

  <div style="width:100%; max-width:1150px; margin:auto;">

    <div id="nodeForm" style="margin-top:24px; width:100%;">

      <form style="display:grid; grid-template-columns:1fr; gap:16px; width:100%;" id="nodeFormGrid">

        <!-- Name -->
        <div style="display:flex; flex-direction:column; width:100%;">
          <label style="color:#a3a3a3; font-size:14px; margin-bottom:6px;">Name</label>
          <input id="nodeName"
            style="width:100%; border-radius:12px; background:#404040; color:white; padding:10px 14px; font-size:14px; border:none; outline:none;"
            placeholder="My node"
            value="<%- node.name %>">
        </div>

        <!-- Tags -->
        <div style="display:flex; flex-direction:column; width:100%;">
          <label style="color:#a3a3a3; font-size:14px; margin-bottom:6px;">Tags</label>
          <input id="nodeTags"
            style="width:100%; border-radius:12px; background:#404040; color:white; padding:10px 14px; font-size:14px; border:none; outline:none;"
            placeholder="Tag 1 - Tag 2 - Tag 3"
            value="<%- node.tags %>">
        </div>

        <!-- RAM -->
        <div style="display:flex; flex-direction:column; width:100%;">
          <label style="color:#a3a3a3; font-size:14px; margin-bottom:6px;">RAM (GB)</label>
          <input id="nodeRam"
            type="number"
            style="width:100%; border-radius:12px; background:#404040; color:white; padding:10px 14px; font-size:14px; border:none; outline:none;"
            placeholder="8"
            value="<%- node.ram %>">
        </div>

        <!-- Disk -->
        <div style="display:flex; flex-direction:column; width:100%;">
          <label style="color:#a3a3a3; font-size:14px; margin-bottom:6px;">Disk (GB)</label>
          <input id="nodeDisk"
            type="number"
            style="width:100%; border-radius:12px; background:#404040; color:white; padding:10px 14px; font-size:14px; border:none; outline:none;"
            placeholder="40"
            value="<%- node.disk %>">
        </div>

        <!-- Processor -->
        <div style="display:flex; flex-direction:column; width:100%;">
          <label style="color:#a3a3a3; font-size:14px; margin-bottom:6px;">Processor</label>
          <input id="nodeProcessor"
            style="width:100%; border-radius:12px; background:#404040; color:white; padding:10px 14px; font-size:14px; border:none; outline:none;"
            placeholder="AMD EPYC 9454 - 16 Threads"
            value="<%- node.processor %>">
        </div>

        <!-- IP Address -->
        <div style="display:flex; flex-direction:column; width:100%;">
          <label style="color:#a3a3a3; font-size:14px; margin-bottom:6px;">IP Address</label>
          <input id="nodeAddress"
            style="width:100%; border-radius:12px; background:#404040; color:white; padding:10px 14px; font-size:14px; border:none; outline:none;"
            placeholder="192.168.1.1 or my.hostnamehere.com"
            value="<%- node.address %>">
        </div>

        <!-- Daemon Port -->
        <div style="display:flex; flex-direction:column; width:100%;">
          <label style="color:#a3a3a3; font-size:14px; margin-bottom:6px;">Daemon Port</label>
          <input id="nodePort"
            type="number"
            style="width:100%; border-radius:12px; background:#404040; color:white; padding:10px 14px; font-size:14px; border:none; outline:none;"
            placeholder="8080"
            value="<%- node.port %>">
        </div>

        <!-- Access Key -->
        <div style="display:flex; flex-direction:column; width:100%;">
          <label style="color:#a3a3a3; font-size:14px; margin-bottom:6px;">Access Key</label>
          <input id="nodeApiKey"
            style="width:100%; border-radius:12px; background:#404040; color:white; padding:10px 14px; font-size:14px; border:none; outline:none;"
            placeholder="KS Wings_xxxxxxxxxxxxxxxx"
            value="<%- node.apiKey %>">
        </div>

        <!-- Submit -->
        <div style="grid-column:1 / -1; margin-top:8px;">
          <button type="submit"
            style="width:100%; border-radius:12px; background:#6366f1; color:white; padding:10px; font-size:14px; font-weight:600; border:none; cursor:pointer;">
            Apply Changes
          </button>
        </div>

      </form>

    </div>
  </div>
</div>

<!-- Responsive 2 Column for Desktop -->
<style>
@media (min-width: 768px) {
  #nodeFormGrid {
    grid-template-columns: 1fr 1fr !important;
  }
}
</style>

<script>
document.getElementById('saveNodeBtn').addEventListener('click', function() {
    const name = document.getElementById('nodeName').value;
    const tags = document.getElementById('nodeTags').value.split('-');
    const ram = document.getElementById('nodeRam').value;
    const disk = document.getElementById('nodeDisk').value;
    const processor = document.getElementById('nodeProcessor').value;
    const address = document.getElementById('nodeAddress').value;
    const port = document.getElementById('nodePort').value;
    const apiKey = document.getElementById('nodeApiKey').value;

    const nodeData = {
        name, tags, ram, disk, processor, address, port, apiKey
    };

    fetch('/admin/node/<%- node.id %>', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(nodeData)
    })
    .then(response => {
        if (response.ok) {
            return response.json();
        }
        throw new Error('Failed to edit node');
    })
    .then(data => {
        console.log('Node edited:', data);
        window.location.href = '../nodes?err=EDITED'
    })
    .catch(error => console.error('Error editing node:', error));
});
</script>

</main>
<%- include('../components/footer') %>
