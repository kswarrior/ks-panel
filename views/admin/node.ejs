<%- include('../components/template') %>

<main id="content">  
<div id="nodeForm" class="mt-6 px-8 w-full">  
	<form>  
	 <label class="text-neutral-400 text-sm tracking-tight mb-2">Name:</label>  
	 <input id="nodeName" class="rounded-xl focus:ring-transparent focus:border-transparent text-white text-sm mt-2 mb-6 w-96 items-center transition justify-left gap-16 hover:bg-white/5 px-4 py-2 flex border-white/5 bg-neutral-600/20 placeholder:text-white/20 text-white border border-black/10" placeholder="My node" value="<%- node.name %>">  

	 <label class="text-neutral-400 text-sm tracking-tight mb-2">Location:</label>  
     <select id="nodeLocation" class="rounded-xl focus:ring-transparent focus:border-transparent text-white text-sm mt-2 mb-6 w-96 items-center transition justify-left gap-16 hover:bg-white/5 px-4 py-2 flex border-white/5 bg-neutral-600/20 placeholder:text-white/20 text-white border border-black/10">
  <option value="">Select a location</option>
  <% locations.forEach(loc => { %>
    <option value="<%= loc.id %>" <%= loc.id === node.location ? 'selected' : '' %>><%= loc.name %></option>
  <% }) %>
</select>

	 <label class="text-neutral-400 text-sm tracking-tight mb-2">RAM (GB):</label>  
	 <input id="nodeRam" class="rounded-xl focus:ring-transparent focus:border-transparent text-white text-sm mt-2 mb-6 w-96 items-center transition justify-left gap-16 hover:bg-white/5 px-4 py-2 flex border-white/5 bg-neutral-600/20 placeholder:text-white/20 text-white border border-black/10" placeholder="8" value="<%- node.ram %>">  

	 <label class="text-neutral-400 text-sm tracking-tight mb-2">Disk (GB):</label>  
	 <input id="nodeDisk" class="rounded-xl focus:ring-transparent focus:border-transparent text-white text-sm mt-2 mb-6 w-96 items-center transition justify-left gap-16 hover:bg-white/5 px-4 py-2 flex border-white/5 bg-neutral-600/20 placeholder:text-white/20 text-white border border-black/10" placeholder="40" value="<%- node.disk %>">  

	 <label class="text-neutral-400 text-sm tracking-tight mb-2">IP Address:</label>  
	 <input id="nodeAddress" class="rounded-xl focus:ring-transparent focus:border-transparent text-white text-sm mt-2 mb-6 w-96 items-center transition justify-left gap-16 hover:bg-white/5 px-4 py-2 flex border-white/5 bg-neutral-600/20 placeholder:text-white/20 text-white border border-black/10" placeholder="192.168.1.1 or my.hostnamehere.com" value="<%- node.address %>">  

	 <label class="text-neutral-400 text-sm tracking-tight mb-2">Daemon Port:</label>  
	 <input id="nodePort" class="rounded-xl focus:ring-transparent focus:border-transparent text-white text-sm mt-2 mb-6 w-96 items-center transition justify-left gap-16 hover:bg-white/5 px-4 py-2 flex border-white/5 bg-neutral-600/20 placeholder:text-white/20 text-white border border-black/10" placeholder="8080" value="<%- node.port %>">  

	 <label class="text-neutral-400 text-sm tracking-tight mb-2">Access Key:</label>  
	 <input id="nodeApiKey" class="rounded-xl focus:ring-transparent focus:border-transparent text-white text-sm mt-2 mb-6 w-96 items-center transition justify-left gap-16 hover:bg-white/5 px-4 py-2 flex border-white/5 bg-neutral-600/20 placeholder:text-white/20 text-white border border-black/10" placeholder="skyportd_xxxxxxxxxxxxxxxx" value="<%- node.apiKey %>">  

	 <button id="saveNodeBtn" type="button" class="block rounded-xl <%= theme['button-color'] %> px-3 py-2 text-center text-sm font-medium shadow-lg transition focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">Apply Changes</button>

	</form>  
</div>  

<script>
  document.getElementById('saveNodeBtn').addEventListener('click', async function() {
    const name = document.getElementById('nodeName').value.trim();
    const location = document.getElementById('nodeLocation').value.trim();  // Keep
    const ram = document.getElementById('nodeRam').value.trim();
    const disk = document.getElementById('nodeDisk').value.trim();
    const address = document.getElementById('nodeAddress').value.trim();
    const port = document.getElementById('nodePort').value.trim();
    const apiKey = document.getElementById('nodeApiKey').value.trim();

    const nodeData = {
      name, location, ram, disk, address, port, apiKey
    };

    try {
      const response = await fetch('/admin/node/<%= node.id %>', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(nodeData)
      });

      if (!response.ok) {
        const errText = await response.text();
        throw new Error(errText || 'Failed to edit node');
      }

      window.location.href = '../nodes?err=EDITED';
    } catch (error) {
      console.error('Error editing node:', error);
      alert(error.message);  // ADD: Show error to user
    }
  });
</script>  
</main>  
<%- include('../components/footer') %>
