<%- include('../components/template') %>

<main id="content">
  <!-- Wrapper -->
<div class="w-full min-h-screen overflow-x-hidden px-3 sm:px-6 lg:px-8">

  <!-- Card Container -->
  <div class="w-full max-w-6xl mx-auto">

    <!-- Node Form -->
    <div id="nodeForm" class="mt-6 w-full">

      <form class="grid grid-cols-1 md:grid-cols-2 gap-4 w-full">

        <!-- Name -->
        <div class="flex flex-col w-full">
          <label class="text-neutral-400 text-sm mb-1">Name</label>
          <input id="nodeName"
            class="w-full rounded-xl bg-neutral-700/40 text-white px-4 py-2 text-sm outline-none focus:ring-2 focus:ring-indigo-500"
            placeholder="My node"
            value="<%- node.name %>">
        </div>

        <!-- Tags -->
        <div class="flex flex-col w-full">
          <label class="text-neutral-400 text-sm mb-1">Tags</label>
          <input id="nodeTags"
            class="w-full rounded-xl bg-neutral-700/40 text-white px-4 py-2 text-sm outline-none focus:ring-2 focus:ring-indigo-500"
            placeholder="Tag 1 - Tag 2 - Tag 3"
            value="<%- node.tags %>">
        </div>

        <!-- RAM -->
        <div class="flex flex-col w-full">
          <label class="text-neutral-400 text-sm mb-1">RAM (GB)</label>
          <input id="nodeRam"
            type="number"
            class="w-full rounded-xl bg-neutral-700/40 text-white px-4 py-2 text-sm outline-none focus:ring-2 focus:ring-indigo-500"
            placeholder="8"
            value="<%- node.ram %>">
        </div>

        <!-- Disk -->
        <div class="flex flex-col w-full">
          <label class="text-neutral-400 text-sm mb-1">Disk (GB)</label>
          <input id="nodeDisk"
            type="number"
            class="w-full rounded-xl bg-neutral-700/40 text-white px-4 py-2 text-sm outline-none focus:ring-2 focus:ring-indigo-500"
            placeholder="40"
            value="<%- node.disk %>">
        </div>

        <!-- Processor -->
        <div class="flex flex-col w-full">
          <label class="text-neutral-400 text-sm mb-1">Processor</label>
          <input id="nodeProcessor"
            class="w-full rounded-xl bg-neutral-700/40 text-white px-4 py-2 text-sm outline-none focus:ring-2 focus:ring-indigo-500"
            placeholder="AMD EPYC 9454 - 16 Threads"
            value="<%- node.processor %>">
        </div>

        <!-- IP Address -->
        <div class="flex flex-col w-full">
          <label class="text-neutral-400 text-sm mb-1">IP Address</label>
          <input id="nodeAddress"
            class="w-full rounded-xl bg-neutral-700/40 text-white px-4 py-2 text-sm outline-none focus:ring-2 focus:ring-indigo-500"
            placeholder="192.168.1.1 or my.hostnamehere.com"
            value="<%- node.address %>">
        </div>

        <!-- Daemon Port -->
        <div class="flex flex-col w-full">
          <label class="text-neutral-400 text-sm mb-1">Daemon Port</label>
          <input id="nodePort"
            type="number"
            class="w-full rounded-xl bg-neutral-700/40 text-white px-4 py-2 text-sm outline-none focus:ring-2 focus:ring-indigo-500"
            placeholder="8080"
            value="<%- node.port %>">
        </div>

        <!-- Access Key -->
        <div class="flex flex-col w-full">
          <label class="text-neutral-400 text-sm mb-1">Access Key</label>
          <input id="nodeApiKey"
            class="w-full rounded-xl bg-neutral-700/40 text-white px-4 py-2 text-sm outline-none focus:ring-2 focus:ring-indigo-500"
            placeholder="KS Wings_xxxxxxxxxxxxxxxx"
            value="<%- node.apiKey %>">
        </div>

        <!-- Submit Button -->
        <div class="md:col-span-2 mt-2">
          <button type="submit"
            class="w-full rounded-xl <%= theme['button-color'] %> px-4 py-2 text-sm font-semibold shadow-lg transition hover:scale-[1.02] active:scale-95">
            Apply Changes
          </button>
        </div>

      </form>

    </div>
  </div>
</div>

<script>
document.getElementById('saveNodeBtn').addEventListener('click', function() {
    const name = document.getElementById('nodeName').value;
    const tags = document.getElementById('nodeTags').value.split('-');
    const ram = document.getElementById('nodeRam').value;
    const disk = document.getElementById('nodeDisk').value;
    const processor = document.getElementById('nodeProcessor').value;
    const address = document.getElementById('nodeAddress').value;
    const port = document.getElementById('nodePort').value;
    const apiKey = document.getElementById('nodeApiKey').value;

    const nodeData = {
        name, tags, ram, disk, processor, address, port, apiKey
    };

    fetch('/admin/node/<%- node.id %>', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(nodeData)
    })
    .then(response => {
        if (response.ok) {
            return response.json();
        }
        throw new Error('Failed to edit node');
    })
    .then(data => {
        console.log('Node edited:', data);
        window.location.href = '../nodes?err=EDITED'
    })
    .catch(error => console.error('Error editing node:', error));
});
</script>
</main>
<%- include('../components/footer') %>
