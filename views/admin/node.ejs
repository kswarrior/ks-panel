<%- include('../components/template') %>
<main id="content">
<div id="nodeForm" class="mt-6 px-4 sm:px-8 w-full">
  <form class="grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-4">
    
    <div class="flex flex-col">
      <label class="text-neutral-400 text-sm tracking-tight mb-2">Name:</label>
      <input id="nodeName" class="rounded-xl text-white text-sm px-4 py-2 border border-black/10 bg-neutral-600/20 placeholder:text-white/20 focus:ring-0 focus:border-transparent w-full" placeholder="My node" value="<%- node.name %>">
    </div>

    <div class="flex flex-col">
      <label class="text-neutral-400 text-sm tracking-tight mb-2">Tags:</label>
      <input id="nodeTags" class="rounded-xl text-white text-sm px-4 py-2 border border-black/10 bg-neutral-600/20 placeholder:text-white/20 focus:ring-0 focus:border-transparent w-full" placeholder="Tag 1 - Tag 2 - Tag 3" value="<%- node.tags %>">
    </div>

    <div class="flex flex-col">
      <label class="text-neutral-400 text-sm tracking-tight mb-2">RAM (GB):</label>
      <input id="nodeRam" class="rounded-xl text-white text-sm px-4 py-2 border border-black/10 bg-neutral-600/20 placeholder:text-white/20 focus:ring-0 focus:border-transparent w-full" placeholder="8" value="<%- node.ram %>">
    </div>

    <div class="flex flex-col">
      <label class="text-neutral-400 text-sm tracking-tight mb-2">Disk (GB):</label>
      <input id="nodeDisk" class="rounded-xl text-white text-sm px-4 py-2 border border-black/10 bg-neutral-600/20 placeholder:text-white/20 focus:ring-0 focus:border-transparent w-full" placeholder="40" value="<%- node.disk %>">
    </div>

    <div class="flex flex-col">
      <label class="text-neutral-400 text-sm tracking-tight mb-2">Processor:</label>
      <input id="nodeProcessor" class="rounded-xl text-white text-sm px-4 py-2 border border-black/10 bg-neutral-600/20 placeholder:text-white/20 focus:ring-0 focus:border-transparent w-full" placeholder="AMD EPYC 9454 - 16 Threads" value="<%- node.processor %>">
    </div>

    <div class="flex flex-col">
      <label class="text-neutral-400 text-sm tracking-tight mb-2">IP Address:</label>
      <input id="nodeAddress" class="rounded-xl text-white text-sm px-4 py-2 border border-black/10 bg-neutral-600/20 placeholder:text-white/20 focus:ring-0 focus:border-transparent w-full" placeholder="192.168.1.1 or my.hostnamehere.com" value="<%- node.address %>">
    </div>

    <div class="flex flex-col">
      <label class="text-neutral-400 text-sm tracking-tight mb-2">Daemon Port:</label>
      <input id="nodePort" class="rounded-xl text-white text-sm px-4 py-2 border border-black/10 bg-neutral-600/20 placeholder:text-white/20 focus:ring-0 focus:border-transparent w-full" placeholder="8080" value="<%- node.port %>">
    </div>

    <div class="flex flex-col">
      <label class="text-neutral-400 text-sm tracking-tight mb-2">Access Key:</label>
      <input id="nodeApiKey" class="rounded-xl text-white text-sm px-4 py-2 border border-black/10 bg-neutral-600/20 placeholder:text-white/20 focus:ring-0 focus:border-transparent w-full" placeholder="KS Wings_xxxxxxxxxxxxxxxx" value="<%- node.apiKey %>">
    </div>

    <div class="sm:col-span-2">
      <button id="saveNodeBtn" type="button" class="w-full rounded-xl <%= theme['button-color'] %> px-3 py-2 text-sm font-medium shadow-lg transition focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
        Apply Changes
      </button>
    </div>

  </form>
</div>

<script>
document.getElementById('saveNodeBtn').addEventListener('click', function() {
    const name = document.getElementById('nodeName').value;
    const tags = document.getElementById('nodeTags').value.split('-');
    const ram = document.getElementById('nodeRam').value;
    const disk = document.getElementById('nodeDisk').value;
    const processor = document.getElementById('nodeProcessor').value;
    const address = document.getElementById('nodeAddress').value;
    const port = document.getElementById('nodePort').value;
    const apiKey = document.getElementById('nodeApiKey').value;

    const nodeData = {
        name, tags, ram, disk, processor, address, port, apiKey
    };

    fetch('/admin/node/<%- node.id %>', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(nodeData)
    })
    .then(response => {
        if (response.ok) {
            return response.json();
        }
        throw new Error('Failed to edit node');
    })
    .then(data => {
        console.log('Node edited:', data);
        window.location.href = '../nodes?err=EDITED'
    })
    .catch(error => console.error('Error editing node:', error));
});
</script>
</main>
<%- include('../components/footer') %>
