<!doctype html>
<html lang="en">
<head>
   <title><%= name %></title>
   <% if (logo == true) { %>
      <link rel="icon" href="/assets/logo.png" type="image/x-icon">
   <% } else { %>
      <link rel="icon" href="https://i.imgur.com/uvDunAR.png" type="image/x-icon">
   <% } %>

   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <meta content="<%= ogTitle %>" property="og:title">
   <meta content="<%= ogDescription %>" property="og:description">

   <link rel="preconnect" href="https://fonts.googleapis.com">
   <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
   <link href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">

   <style>
      :root {
         --bg: #0a0a0a;
         --sidebar-bg: #101010;
         --accent: #22d3ee;
         --accent-glow: rgba(34, 211, 238, 0.25);
         --border: rgba(255,255,255,0.07);
         --text: #f1f5f9;
         --muted: #94a3b8;
      }

      * { margin:0; padding:0; box-sizing:border-box; }
      body {
         font-family: 'Public Sans', system-ui, sans-serif;
         background: var(--bg);
         color: var(--text);
         height: 100vh;
         overflow: hidden;
      }

      /* ==================== SIDEBAR ==================== */
      #pc-sidebar {
         position: fixed;
         top: 0; bottom: 0; left: 0;
         z-index: 50;
         width: 240px;
         padding: 10px;
         transition: width 0.4s cubic-bezier(0.32, 0.72, 0, 1);
         display: none;
      }
      @media (min-width: 1024px) { #pc-sidebar { display: flex; } }

      #pc-sidebar.collapsed { width: 68px; }

      #pc-sidebar.right-0 {
         left: auto;
         right: 0;
      }

      .sidebar-inner {
         height: 100%;
         display: flex;
         flex-direction: column;
         background: var(--sidebar-bg);
         border: 1px solid var(--border);
         border-radius: 28px 28px 28px 18px;
         overflow: hidden;
         box-shadow: 0 20px 40px -15px rgba(0,0,0,0.7);
      }

      .logo-area {
         padding: 22px 24px 16px;
         display: flex;
         align-items: center;
         gap: 12px;
      }
      .logo-area img { width: 32px; height: 32px; border-radius: 8px; }
      .logo-area h1 {
         font-size: 1.35rem;
         font-weight: 600;
         letter-spacing: -0.04em;
         white-space: nowrap;
      }
      #pc-sidebar.collapsed .logo-area h1 { display: none; }

      .user-area {
         display: flex;
         align-items: center;
         gap: 14px;
         padding: 14px 20px;
         border-top: 1px solid var(--border);
         border-bottom: 1px solid var(--border);
      }
      .user-avatar { width: 38px; height: 38px; border-radius: 12px; }
      .user-info .name { font-weight: 600; font-size: 0.95rem; }
      .user-info .id { font-size: 0.78rem; color: var(--muted); }
      #pc-sidebar.collapsed .user-info { display: none; }

      .nav-wrapper {
         flex: 1;
         padding: 12px 8px;
         overflow-y: auto;
      }
      .nav-list {
         position: relative;
         list-style: none;
      }
      #active-background {
         position: absolute;
         left: 8px; right: 8px;
         height: 46px;
         background: linear-gradient(90deg, var(--accent-glow), transparent);
         border-radius: 16px;
         transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
         box-shadow: 0 0 20px var(--accent-glow);
      }

      .nav-link {
         position: relative;
         z-index: 2;
         display: flex;
         align-items: center;
         gap: 16px;
         padding: 13px 22px;
         margin: 4px 8px;
         border-radius: 14px;
         color: var(--muted);
         text-decoration: none;
         font-size: 0.94rem;
         transition: all 0.25s ease;
      }
      .nav-link:hover {
         background: rgba(255,255,255,0.06);
         color: white;
         transform: translateX(6px);
      }
      .nav-link.active {
         color: white;
         background: rgba(34,211,238,0.12);
         font-weight: 500;
      }
      .nav-link svg {
         width: 22px;
         height: 22px;
         flex-shrink: 0;
      }
      #pc-sidebar.collapsed .nav-link span { display: none; }

      .admin-header {
         padding: 22px 26px 6px;
         font-size: 0.73rem;
         font-weight: 700;
         color: var(--muted);
         letter-spacing: 1px;
         text-transform: uppercase;
      }
      #pc-sidebar.collapsed .admin-header { display: none; }

      .logout-link {
         display: flex;
         align-items: center;
         gap: 16px;
         padding: 18px 24px;
         color: #777;
         text-decoration: none;
         border-top: 1px solid var(--border);
         transition: all 0.25s;
      }
      .logout-link:hover {
         color: white;
         background: rgba(255,255,255,0.05);
      }

      /* ==================== MAIN AREA ==================== */
      #colcont {
         margin-left: 240px;
         transition: margin-left 0.4s cubic-bezier(0.32, 0.72, 0, 1);
         height: 100vh;
         overflow-y: auto;
      }
      #pc-sidebar.collapsed ~ #colcont { margin-left: 68px; }
      #pc-sidebar.right-0 ~ #colcont { margin-left: 0; margin-right: 240px; }
      #pc-sidebar.collapsed.right-0 ~ #colcont { margin-right: 68px; }

      /* Top Bar */
      .top-bar {
         position: sticky;
         top: 0;
         z-index: 40;
         height: 70px;
         display: flex;
         align-items: center;
         padding: 0 24px;
         background: rgba(10,10,10,0.92);
         backdrop-filter: blur(24px);
         border-bottom: 1px solid var(--border);
      }

      .sidebar-toggle {
         width: 46px; height: 46px;
         display: flex;
         align-items: center;
         justify-content: center;
         border-radius: 14px;
         border: 1px solid var(--border);
         color: white;
         background: transparent;
         transition: all 0.2s;
      }
      .sidebar-toggle:hover {
         background: rgba(255,255,255,0.08);
         transform: scale(1.1);
      }

      .search-container {
         flex: 1;
         max-width: 420px;
         margin: 0 20px;
      }
      .search-box {
         display: flex;
         align-items: center;
         height: 48px;
         background: rgba(255,255,255,0.04);
         border: 1px solid var(--border);
         border-radius: 9999px;
         padding: 0 20px;
         color: white;
      }
      .search-box input {
         flex: 1;
         background: transparent;
         border: none;
         outline: none;
         font-size: 0.96rem;
         margin-left: 12px;
      }
      .search-box input::placeholder { color: #64748b; }

      /* Profile */
      .profile-btn {
         display: flex;
         align-items: center;
         gap: 12px;
         padding: 6px 12px 6px 6px;
         border-radius: 9999px;
         background: rgba(255,255,255,0.04);
         transition: all 0.25s;
      }
      .profile-btn:hover { background: rgba(255,255,255,0.09); }
      .profile-btn img {
         width: 36px; height: 36px;
         border-radius: 10px;
      }

      .dropdown-menu {
         position: absolute;
         right: 20px;
         top: 68px;
         width: 260px;
         background: #fff;
         color: #111;
         border-radius: 18px;
         box-shadow: 0 25px 50px -15px rgba(0,0,0,0.5);
         opacity: 0;
         transform: scale(0.95);
         pointer-events: none;
         transition: all 0.3s cubic-bezier(0.34,1.56,0.64,1);
      }
      .dropdown-menu.show {
         opacity: 1;
         transform: scale(1);
         pointer-events: all;
      }

      /* Mobile Toggle */
      #mobile-sidebar-toggle {
         position: fixed;
         top: 16px; left: 16px;
         z-index: 9999;
         padding: 12px;
         background: #141414;
         border: 1px solid var(--border);
         border-radius: 14px;
         color: white;
         display: block;
      }
      @media (min-width: 1024px) {
         #mobile-sidebar-toggle { display: none; }
      }

      /* Loader */
      #loader {
         position: fixed;
         inset: 0;
         background: var(--bg);
         display: flex;
         align-items: center;
         justify-content: center;
         z-index: 9999;
         transition: opacity 0.5s ease;
      }
      #loader.hidden { opacity: 0; pointer-events: none; }

      .loading-spin svg path {
         animation: pulse 1s infinite linear;
      }
      .loading-spin svg path:nth-child(2) { animation-delay: -0.083s; }
      .loading-spin svg path:nth-child(3) { animation-delay: -0.166s; }
      .loading-spin svg path:nth-child(4) { animation-delay: -0.249s; }
      .loading-spin svg path:nth-child(5) { animation-delay: -0.332s; }
      .loading-spin svg path:nth-child(6) { animation-delay: -0.415s; }
      .loading-spin svg path:nth-child(7) { animation-delay: -0.498s; }
      .loading-spin svg path:nth-child(8) { animation-delay: -0.581s; }
      .loading-spin svg path:nth-child(9) { animation-delay: -0.664s; }
      .loading-spin svg path:nth-child(10){ animation-delay: -0.747s; }
      .loading-spin svg path:nth-child(11){ animation-delay: -0.83s; }
      .loading-spin svg path:nth-child(12){ animation-delay: -0.913s; }

      @keyframes pulse {
         50% { fill: #868686; }
         100% { fill: rgba(134,134,134,0.3); }
      }
   </style>
</head>
<body style="font-family: 'Public Sans'">

   <!-- Mobile Toggle -->
   <button id="mobile-sidebar-toggle">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.25">
         <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
      </svg>
   </button>

   <!-- Desktop Sidebar -->
   <div id="pc-sidebar" class="transition-all duration-300 ease-in-out">
      <div id="pc-sidebar2" class="sidebar-inner">
         <!-- Logo -->
         <div class="logo-area">
            <a href="/" class="flex items-center">
               <% if (logo == true) { %>
                  <img src="/assets/logo.png" alt="Logo">
               <% } %>
               <h1><%= name %></h1>
            </a>
         </div>

         <!-- User -->
         <div class="user-area">
            <img class="user-avatar" src="https://api.dicebear.com/9.x/thumbs/svg?seed=<%= user.username %>" alt="">
            <div class="user-info">
               <div class="name"><%= user.username %></div>
               <div class="id"><%= user.userId.substring(0,6) %></div>
            </div>
         </div>

         <!-- Navigation -->
         <div class="nav-wrapper">
            <ul class="nav-list" role="list">
               <div id="active-background"></div>

               <a href="/instances" class="nav-link active" data-search="container instances servers">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" fill="currentColor"><rect width="256" height="256" fill="none"/><path d="M220,169.09l-92,53.65L36,169.09A8,8,0,0,0,28,182.91l96,56a8,8,0,0,0,8.06,0l96-56A8,8,0,1,0,220,169.09Z"/><path d="M220,121.09l-92,53.65L36,121.09A8,8,0,0,0,28,134.91l96,56a8,8,0,0,0,8.06,0l96-56A8,8,0,1,0,220,121.09Z"/><path d="M28,86.91l96,56a8,8,0,0,0,8.06,0l96-56a8,8,0,0,0,0-13.82l-96-56a8,8,0,0,0-8.06,0l-96,56a8,8,0,0,0,0,13.82Z"/></svg>
                  <span><%= req.translations.instances %></span>
               </a>

               <a href="/account" class="nav-link" data-search="account profile <%= user.username %>">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M10 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6ZM3.465 14.493a1.23 1.23 0 0 0 .41 1.412A9.957 9.957 0 0 0 10 18c2.31 0 4.438-.784 6.131-2.1.43-.333.604-.903.408-1.41a7.002 7.002 0 0 0-13.074.003Z" /></svg>
                  <span><%= req.translations.account %></span>
               </a>

               <% plugins.forEach(plugin => { %>
                  <% if (plugin.sidebar) { %>
                     <% Object.entries(plugin.sidebar).forEach(([key, value]) => { %>
                        <a href="<%= value.url %>" class="nav-link" data-search="<%= value.search_data %>">
                           <% if (value.icon) { %>
                              <span class="svg-icon" data-icon-url="<%= value.icon %>"></span>
                           <% } else { %>
                              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M10 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6ZM3.465 14.493a1.23 1.23 0 0 0 .41 1.412A9.957 9.957 0 0 0 10 18c2.31 0 4.438-.784 6.131-2.1.43-.333.604-.903.408-1.41a7.002 7.002 0 0 0-13.074.003Z" /></svg>
                           <% } %>
                           <span><%= key %></span>
                        </a>
                     <% }); %>
                  <% } %>
               <% }); %>

               <% if (user.admin == true) { %>
                  <p class="admin-header">Admin Panel</p>

                  <a href="/admin/overview" class="nav-link"><span>Overview</span></a>
                  <a href="/admin/settings" class="nav-link"><span>Settings</span></a>
                  <a href="/admin/analytics" class="nav-link"><span>Analytics</span></a>
                  <a href="/admin/users" class="nav-link"><span>Users</span></a>
                  <a href="/admin/instances" class="nav-link"><span>Instances</span></a>
                  <a href="/admin/nodes" class="nav-link"><span>Nodes</span></a>
                  <a href="/admin/images" class="nav-link"><span>Images</span></a>
                  <a href="/admin/apikeys" class="nav-link"><span>API Keys</span></a>
                  <a href="/admin/auditlogs" class="nav-link"><span>Audit Logs</span></a>
                  <a href="/admin/plugins" class="nav-link"><span>Plugins</span></a>
               <% } %>
            </ul>
         </div>

         <!-- Logout -->
         <a href="/auth/logout" class="logout-link">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
               <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 9V5.25A2.25 2.25 0 0 1 10.5 3h6a2.25 2.25 0 0 1 2.25 2.25v13.5A2.25 2.25 0 0 1 16.5 21h-6a2.25 2.25 0 0 1-2.25-2.25V15m-3 0-3-3m0 0 3-3m-3 3H15" />
            </svg>
            <span><%= req.translations.signOut %></span>
         </a>
      </div>
   </div>

   <!-- Main Content -->
   <div id="colcont">
      <!-- Top Bar -->
      <div class="top-bar">
         <button id="sidebar-toggle" class="sidebar-toggle">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.25">
               <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
            </svg>
         </button>

         <div class="search-container">
            <div class="search-box">
               <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 01-14 0 7 7 0 0114 0z" />
               </svg>
               <input id="searchInput" type="search" placeholder="<%= req.translations.search %>" autocomplete="off">
            </div>
         </div>

         <!-- Profile Dropdown -->
         <div class="ml-auto relative">
            <button id="user-menu-button" class="profile-btn" onclick="toggleDropdown()">
               <img src="https://api.dicebear.com/9.x/thumbs/svg?seed=<%= user.username %>" alt="">
               <span class="hidden lg:block">
                  <%= user.username %>
                  <span class="font-mono text-xs text-zinc-400">(<%= user.userId.substring(0,6) %>)</span>
               </span>
            </button>

            <div id="dropdown-menu" class="dropdown-menu">
               <div style="padding:24px 20px;">
                  <label style="font-size:0.8rem;color:#666;margin-bottom:8px;display:block;">Language</label>
                  <select id="language-selector" style="width:100%;padding:12px;border-radius:12px;border:1px solid #ddd;background:white;" onchange="changeLanguage(this.value)">
                     <% languages.forEach(function(language) { %>
                        <option value="<%= language %>" <%= (req.cookies.lang ? req.cookies.lang : 'en') === language ? 'selected' : '' %>>
                           <%= req.translations[language] %>
                        </option>
                     <% }); %>
                  </select>
               </div>
            </div>
         </div>
      </div>

      <!-- PAGE CONTENT WILL BE INJECTED HERE BY YOUR BACKEND -->
      <div id="content" style="padding:28px;"></div>

      <!-- Loader -->
      <div id="loader" class="loading-spin">
         <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 27 27" fill="#868686">
            <!-- All 12 paths from your original loader -->
            <path d="M18.696,10.5c-0.275-0.479-0.113-1.09,0.365-1.367l4.759-2.751c0.482-0.273,1.095-0.11,1.37,0.368 c0.276,0.479,0.115,1.092-0.364,1.364l-4.764,2.751C19.583,11.141,18.973,10.977,18.696,10.5z"/>
            <path d="M16.133,6.938l2.75-4.765c0.276-0.478,0.889-0.643,1.367-0.366c0.479,0.276,0.641,0.886,0.365,1.366l-2.748,4.762 C17.591,8.415,16.979,8.58,16.5,8.303C16.021,8.027,15.856,7.414,16.133,6.938z"/>
            <path d="M13.499,7.5c-0.552,0-1-0.448-1-1.001V1c0-0.554,0.448-1,1-1c0.554,0,1.003,0.447,1.003,1v5.499 C14.5,7.053,14.053,7.5,13.499,7.5z"/>
            <path d="M8.303,10.5c-0.277,0.477-0.888,0.641-1.365,0.365L2.175,8.114C1.697,7.842,1.532,7.229,1.808,6.75 c0.277-0.479,0.89-0.642,1.367-0.368l4.762,2.751C8.416,9.41,8.58,10.021,8.303,10.5z"/>
            <path d="M9.133,7.937l-2.75-4.763c-0.276-0.48-0.111-1.09,0.365-1.366c0.479-0.277,1.09-0.114,1.367,0.366l2.75,4.765 c0.274,0.476,0.112,1.088-0.367,1.364C10.021,8.581,9.409,8.415,9.133,7.937z"/>
            <path d="M6.499,14.5H1c-0.554,0-1-0.448-1-1c0-0.554,0.447-1.001,1-1.001h5.499c0.552,0,1.001,0.448,1.001,1.001 C7.5,14.052,7.052,14.5,6.499,14.5z"/>
            <path d="M8.303,16.502c0.277,0.478,0.113,1.088-0.365,1.366l-4.762,2.749c-0.478,0.273-1.091,0.112-1.368-0.366 c-0.276-0.479-0.111-1.089,0.367-1.368l4.762-2.748C7.415,15.856,8.026,16.021,8.303,16.502z"/>
            <path d="M10.866,20.062l-2.75,4.767c-0.277,0.475-0.89,0.639-1.367,0.362c-0.477-0.277-0.642-0.886-0.365-1.365l2.75-4.764 c0.277-0.477,0.888-0.638,1.366-0.365C10.978,18.974,11.141,19.585,10.866,20.062z"/>
            <path d="M13.499,19.502c0.554,0,1.003,0.448,1.003,1.002v5.498c0,0.55-0.448,0.999-1.003,0.999c-0.552,0-1-0.447-1-0.999v-5.498 C12.499,19.95,12.946,19.502,13.499,19.502z"/>
            <path d="M17.867,19.062l2.748,4.764c0.275,0.479,0.113,1.088-0.365,1.365c-0.479,0.276-1.091,0.112-1.367-0.362l-2.75-4.767 c-0.276-0.477-0.111-1.088,0.367-1.365C16.979,18.424,17.591,18.585,17.867,19.062z"/>
            <path d="M18.696,16.502c0.276-0.48,0.887-0.646,1.365-0.367l4.765,2.748c0.479,0.279,0.64,0.889,0.364,1.368 c-0.275,0.479-0.888,0.64-1.37,0.366l-4.759-2.749C18.583,17.59,18.421,16.979,18.696,16.502z"/>
            <path d="M25.998,12.499h-5.501c-0.552,0-1.001,0.448-1.001,1.001c0,0.552,0.447,1,1.001,1h5.501c0.554,0,1.002-0.448,1.002-1 C27,12.946,26.552,12.499,25.998,12.499z"/>
         </svg>
      </div>
   </div>

   <!-- Scripts -->
   <script src="/javascript/search/index.js"></script>
   <script src="/javascript/language/index.js"></script>

   <!-- SVG Icon Loader -->
   <script>
                              document.addEventListener("DOMContentLoaded", function() {
                                  document.querySelectorAll('.svg-icon').forEach(function(span) {
                                      const url = span.getAttribute('data-icon-url');
                          
                                      fetch(url)
                                          .then(response => {
                                              if (!response.ok) {
                                                  throw new Error('Network response was not ok');
                                              } else if (response.status !== 200) {
                                                  throw new Error(`Request failed with status ${response.status}`);
                                              } else if (!response.text().includes('<svg')) {
                                                 throw new Error('Response does not contain an SVG');
                                              }
                                              return response.text();
                                          })
                                          .then(svgContent => {
                                              span.innerHTML = svgContent;
                                          })
                                          .catch(error => {
                                              console.error('Error on Loading the SVG:', error);
                                          });
                                  });
                              });
                          </script>
    <script>
   function toggleDropdown() {
     const dropdownMenu = document.getElementById('dropdown-menu');
     dropdownMenu.classList.toggle('hidden');
     if (!dropdownMenu.classList.contains('hidden')) {
       setTimeout(() => {
         dropdownMenu.style.transform = 'scale(1)';
         dropdownMenu.style.opacity = '1';
       }, 10);
     } else {
       dropdownMenu.style.transform = 'scale(0.95)';
       dropdownMenu.style.opacity = '0';
     }
   }

   window.addEventListener('click', function(e) {
     const userMenuButton = document.getElementById('user-menu-button');
     const dropdownMenu = document.getElementById('dropdown-menu');
     if (!userMenuButton.contains(e.target) && !dropdownMenu.contains(e.target)) {
       dropdownMenu.classList.add('hidden');
       dropdownMenu.style.transform = 'scale(0.95)';
       dropdownMenu.style.opacity = '0';
     }
   });
 </script>
   <!-- All your original JavaScript (sidebar collapse, active link, mobile, dropdown, loader, etc.) -->
   <script>
         document.addEventListener('DOMContentLoaded', function() {
           const navLinks = document.querySelectorAll('.nav-link');
           const activeBackground = document.getElementById('active-background');
           const contentSection = document.getElementById('content');
           let isAnimating = false;
           let currentActiveLink = null;
         
           function getCookie(name) {
             const value = `; ${document.cookie}`;
             const parts = value.split(`; ${name}=`);
             if (parts.length === 2) return parts.pop().split(';').shift();
           }
         
           function setCookie(name, value, days) {
             let expires = '';
             if (days) {
               const date = new Date();
               date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
               expires = `; expires=${date.toUTCString()}`;
             }
             document.cookie = `${name}=${value || ''}${expires}; path=/`;
           }
         
           function updateActiveBackground(link, instant = false) {
             if (!link) return;
             
             const linkRect = link.getBoundingClientRect();
             const navRect = link.closest('ul').getBoundingClientRect();
             const topOffset = linkRect.top - navRect.top + link.closest('ul').scrollTop;
         
             if (instant) {
               activeBackground.style.transition = 'none';
             }
             
             activeBackground.style.height = `${linkRect.height}px`;
             activeBackground.style.transform = `translateY(${topOffset}px)`;
         
             if (instant) {
               // Force a reflow
               void activeBackground.offsetWidth;
               activeBackground.style.transition = 'transform 0.3s ease, height 0.3s ease';
             }
         
             setCookie('lastActiveLink', link.id, 7);
             currentActiveLink = link;
           }
         
           function updateActiveLink(currentPath) {
             let foundActive = false;
             navLinks.forEach((link) => {
               let currentpathx2 = currentPath.replace('instance/', 'instances');
               if (currentpathx2.startsWith(link.getAttribute('href'))) {
                 link.classList.add('active');
                 updateActiveBackground(link, true);
                 foundActive = true;
               } else {
                 link.classList.remove('active');
               }
             });
         
             if (!foundActive) {
               activeBackground.style.transform = 'translateY(0)';
               activeBackground.style.height = '0px';
             }
           }
         
           // Appliquer immÃ©diatement au chargement de la page
           updateActiveLink(window.location.pathname);
         
           function animatePageTransition(href) {
             if (isAnimating) return;
             isAnimating = true;
         
             contentSection.style.opacity = '0';
             contentSection.style.transform = 'translateX(-20px)';
             window.location.href = href;
           }
         
           navLinks.forEach(link => {
             link.addEventListener('click', (e) => {
               e.preventDefault();
               const href = link.getAttribute('href');
               updateActiveLink(href);
               animatePageTransition(href);
             });
           });
         
           window.addEventListener('popstate', () => {
             updateActiveLink(window.location.pathname);
           });
         });


         document.addEventListener('DOMContentLoaded', () => {
            const sidebar = document.querySelector('.sidebar');
            const toggleButton = document.getElementById('sidebar-toggle');
            const colcont = document.getElementById('colcont');

            function setCookie(name, value, days) {
               const date = new Date();
               date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
               const expires = "expires=" + date.toUTCString();
               document.cookie = name + "=" + value + ";" + expires + ";path=/";
            }
            function getCookie(name) {
               const nameEQ = name + "=";
               const ca = document.cookie.split(';');
               for(let i = 0; i < ca.length; i++) {
                  let c = ca[i];
                  while (c.charAt(0) === ' ') c = c.substring(1, c.length);
                  if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
               }
               return null;
            }
            const sidebarState = getCookie('sidebar-collapsed');
            if (sidebarState === 'true') {
               sidebar.classList.add('collapsed');
               colcont.classList.add('colcont');
            } else {
               sidebar.classList.remove('collapsed');
               colcont.classList.remove('colcont');
            }
            toggleButton.addEventListener('click', () => {
               sidebar.classList.toggle('collapsed');
               colcont.classList.toggle('colcont');
               const isCollapsed = sidebar.classList.contains('collapsed');
               setCookie('sidebar-collapsed', isCollapsed, 7);
            });

            const mobileToggleButton = document.getElementById('mobile-sidebar-toggle');
            if (mobileToggleButton) {
               mobileToggleButton.addEventListener('click', () => {
                  sidebar.classList.toggle('open');
                  if (sidebar.classList.contains('open')) {
                     mobileToggleButton.classList.add('right-4');
                     mobileToggleButton.classList.remove('left-4');
                  } else {
                     mobileToggleButton.classList.add('left-4');
                     mobileToggleButton.classList.remove('right-4');
                  }
               });
            }
         });
         </script>         
         

      <style>
         .loading-spin {
           svg {
             fill: #868686;
             
             path:nth-of-type(1) {
               animation: pulse 1s infinite linear;
             }
             path:nth-of-type(2) {
               animation: pulse 1s -.083s infinite linear;
             }
             path:nth-of-type(3) {
               animation: pulse 1s -.166s infinite linear;
             }
             path:nth-of-type(4) {
               animation: pulse 1s -.249s infinite linear;
             }
             path:nth-of-type(5) {
               animation: pulse 1s -.332s infinite linear;
             }
             path:nth-of-type(6) {
               animation: pulse 1s -.415s infinite linear;
             }
             path:nth-of-type(7) {
               animation: pulse 1s -.498s infinite linear;
             }
             path:nth-of-type(8) {
               animation: pulse 1s -.581s infinite linear;
             }  
             path:nth-of-type(9) {
               animation: pulse 1s -.664s infinite linear;
             }
             path:nth-of-type(10) {
               animation: pulse 1s -.747s infinite linear;
             }
             path:nth-of-type(11) {
               animation: pulse 1s -.83s infinite linear;
             }
             path:nth-of-type(12) {
               animation: pulse 1s -.913s infinite linear;
             }
           }
         }
         
         @keyframes pulse {
           50% { fill: #868686; }
           to { fill: rgba(134,134,134,.4); }
         }
      </style>
      <div id="loader" class="loading-spin transition-opacity duration-500 ease-in-out fixed ml-56 mt-16 inset-0 flex items-center justify-center <%= theme['paneltheme-color'] %> transition-opacity duration-300 opacity-100 z-50">
         <svg xmlns="http://www.w3.org/2000/svg" width="27" height="27" viewBox="0 0 27 27" fill="currentColor">
            <path d="M18.696,10.5c-0.275-0.479-0.113-1.09,0.365-1.367l4.759-2.751c0.482-0.273,1.095-0.11,1.37,0.368 c0.276,0.479,0.115,1.092-0.364,1.364l-4.764,2.751C19.583,11.141,18.973,10.977,18.696,10.5z"/>
            <path d="M16.133,6.938l2.75-4.765c0.276-0.478,0.889-0.643,1.367-0.366c0.479,0.276,0.641,0.886,0.365,1.366l-2.748,4.762 C17.591,8.415,16.979,8.58,16.5,8.303C16.021,8.027,15.856,7.414,16.133,6.938z"/>
            <path d="M13.499,7.5c-0.552,0-1-0.448-1-1.001V1c0-0.554,0.448-1,1-1c0.554,0,1.003,0.447,1.003,1v5.499 C14.5,7.053,14.053,7.5,13.499,7.5z"/>
            <path d="M8.303,10.5c-0.277,0.477-0.888,0.641-1.365,0.365L2.175,8.114C1.697,7.842,1.532,7.229,1.808,6.75 c0.277-0.479,0.89-0.642,1.367-0.368l4.762,2.751C8.416,9.41,8.58,10.021,8.303,10.5z"/>
            <path d="M9.133,7.937l-2.75-4.763c-0.276-0.48-0.111-1.09,0.365-1.366c0.479-0.277,1.09-0.114,1.367,0.366l2.75,4.765 c0.274,0.476,0.112,1.088-0.367,1.364C10.021,8.581,9.409,8.415,9.133,7.937z"/>
            <path d="M6.499,14.5H1c-0.554,0-1-0.448-1-1c0-0.554,0.447-1.001,1-1.001h5.499c0.552,0,1.001,0.448,1.001,1.001 C7.5,14.052,7.052,14.5,6.499,14.5z"/>
            <path d="M8.303,16.502c0.277,0.478,0.113,1.088-0.365,1.366l-4.762,2.749c-0.478,0.273-1.091,0.112-1.368-0.366 c-0.276-0.479-0.111-1.089,0.367-1.368l4.762-2.748C7.415,15.856,8.026,16.021,8.303,16.502z"/>
            <path d="M10.866,20.062l-2.75,4.767c-0.277,0.475-0.89,0.639-1.367,0.362c-0.477-0.277-0.642-0.886-0.365-1.365l2.75-4.764 c0.277-0.477,0.888-0.638,1.366-0.365C10.978,18.974,11.141,19.585,10.866,20.062z"/>
            <path d="M13.499,19.502c0.554,0,1.003,0.448,1.003,1.002v5.498c0,0.55-0.448,0.999-1.003,0.999c-0.552,0-1-0.447-1-0.999v-5.498 C12.499,19.95,12.946,19.502,13.499,19.502z"/>
            <path d="M17.867,19.062l2.748,4.764c0.275,0.479,0.113,1.088-0.365,1.365c-0.479,0.276-1.091,0.112-1.367-0.362l-2.75-4.767 c-0.276-0.477-0.111-1.088,0.367-1.365C16.979,18.424,17.591,18.585,17.867,19.062z"/>
            <path d="M18.696,16.502c0.276-0.48,0.887-0.646,1.365-0.367l4.765,2.748c0.479,0.279,0.64,0.889,0.364,1.368 c-0.275,0.479-0.888,0.64-1.37,0.366l-4.759-2.749C18.583,17.59,18.421,16.979,18.696,16.502z"/>
            <path d="M25.998,12.499h-5.501c-0.552,0-1.001,0.448-1.001,1.001c0,0.552,0.447,1,1.001,1h5.501c0.554,0,1.002-0.448,1.002-1 C27,12.946,26.552,12.499,25.998,12.499z"/>
          </svg>
      </div>
